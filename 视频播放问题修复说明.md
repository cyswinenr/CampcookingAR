# 🎬 视频播放问题已修复

## ✅ 问题解决

视频播放失败的问题已经修复！现在改用 **res/raw/** 资源文件方式存储视频。

---

## 🔧 问题原因

### 原因分析：
1. **缺少存储权限**：Android 10+ 访问外部存储需要特殊权限
2. **权限请求缺失**：应用没有在运行时请求存储权限
3. **路径访问限制**：Android 11+ 对外部存储访问有严格限制

### 解决方案：
改用 **res/raw/** 资源文件方式：
- ✅ 不需要任何权限
- ✅ 简单可靠
- ✅ 与应用打包在一起

---

## 📁 新的视频存储方式

### 视频文件位置
```
app/src/main/res/raw/
```

### 需要的视频文件
```
app/src/main/res/raw/
├── video_fire_skills.mp4    ← 生火技巧
├── video_cut_chicken.mp4    ← 砍鸡的方法
└── video_chop_ribs.mp4      ← 砍排骨方法
```

---

## 🚀 如何添加视频文件

### 步骤 1：准备视频文件

确保视频文件满足以下要求：
- 格式：`.mp4` (H.264 + AAC)
- 命名：只能使用**小写字母、数字、下划线**

### 步骤 2：重命名视频文件

按照配置要求重命名：

| 原文件名（可能） | 新文件名（必须） |
|-----------------|-----------------|
| 生火技巧.mp4 | `video_fire_skills.mp4` |
| 砍鸡的方法.mp4 | `video_cut_chicken.mp4` |
| 砍排骨方法.mp4 | `video_chop_ribs.mp4` |

### 步骤 3：复制到 raw 文件夹

```
1. 在 Android Studio 中找到：
   app > src > main > res > raw

2. 将重命名后的视频文件复制到 raw 文件夹

3. 或者直接复制到磁盘路径：
   O:\PadSoftware\CampcookingAR\app\src\main\res\raw\
```

### 步骤 4：编译运行

```
Build → Clean Project
Build → Rebuild Project
Run ▶️
```

---

## ⚠️ 文件命名规则（重要！）

### 必须遵守的规则

| 规则 | 说明 | 示例 |
|------|------|------|
| ✅ 小写字母 | a-z | `video` |
| ✅ 数字 | 0-9 | `video_01` |
| ✅ 下划线 | _ | `video_fire` |
| ❌ 大写字母 | A-Z | ~~Video~~ |
| ❌ 空格 |   | ~~video fire~~ |
| ❌ 中文 | 任何中文字符 | ~~生火技巧~~ |
| ❌ 连字符 | - | ~~video-fire~~ |
| ❌ 特殊字符 | @#$%等 | ~~video@fire~~ |

### 命名示例

```
✅ 正确：
video_fire_skills.mp4
video_cut_chicken.mp4
video_chop_ribs.mp4
video_cooking_01.mp4
video_demo_2024.mp4

❌ 错误：
Video_Fire.mp4          (大写字母)
video fire.mp4          (空格)
生火技巧.mp4            (中文)
video-fire-skills.mp4   (连字符)
Video@Fire.mp4          (特殊字符)
```

---

## 📝 已修改的文件

### 1. `Video.kt`
```kotlin
// 改回使用 resourceName（不含扩展名）
data class Video(
    ...
    val resourceName: String,  // 如："video_fire_skills"
    ...
)
```

### 2. `VideoConfig.kt`
```kotlin
Video(
    id = 1,
    title = "生火技巧",
    resourceName = "video_fire_skills",  // 不含 .mp4
    ...
)
```

### 3. `VideoActivity.kt`
```kotlin
// 从 res/raw/ 加载视频
val resourceId = resources.getIdentifier(
    video.resourceName,
    "raw",
    packageName
)
val videoUri = RawResourceDataSource.buildRawResourceUri(resourceId)
```

---

## 🎯 配置的视频列表

根据 `VideoConfig.kt`，当前配置了 3 个视频：

| ID | 标题 | 资源名称 | 文件名 |
|----|------|----------|--------|
| 1 | 生火技巧 | `video_fire_skills` | `video_fire_skills.mp4` |
| 2 | 砍鸡的方法 | `video_cut_chicken` | `video_cut_chicken.mp4` |
| 3 | 砍排骨方法 | `video_chop_ribs` | `video_chop_ribs.mp4` |

---

## 🎬 测试步骤

### 1. 准备视频文件
```
- video_fire_skills.mp4
- video_cut_chicken.mp4
- video_chop_ribs.mp4
```

### 2. 复制到 raw 文件夹
```
app/src/main/res/raw/
```

### 3. Clean 和 Rebuild
```
Build → Clean Project
Build → Rebuild Project
```

### 4. 运行应用
```
Run ▶️
```

### 5. 测试播放
```
1. 进入团队信息页面
2. 填写信息（或加载保存的信息）
3. 点击"开始野炊"
4. 点击"微课视频"
5. ✅ 应该能看到 3 个视频
6. ✅ 点击任意视频开始播放
```

---

## 💡 如果还没有视频文件

### 临时测试方案

如果您暂时没有实际的视频文件，可以：

1. **使用占位视频**
   - 创建一个简短的测试视频
   - 重命名为对应的文件名
   - 放入 raw 文件夹

2. **修改配置减少视频数量**
   
   打开 `VideoConfig.kt`，可以先注释掉部分视频：
   
   ```kotlin
   fun getVideoList(): List<Video> {
       return listOf(
           Video(
               id = 1,
               title = "生火技巧",
               resourceName = "video_fire_skills",
               ...
           )
           // 暂时注释掉其他视频
           /*
           ,Video(
               id = 2,
               ...
           )
           */
       )
   }
   ```

3. **只提供一个视频文件**
   - 只准备 `video_fire_skills.mp4`
   - 注释掉 VideoConfig.kt 中的其他视频配置

---

## ⚙️ 方案对比

### res/raw/ 方式（当前使用）✅

**优点：**
- ✅ 不需要任何权限
- ✅ 简单可靠
- ✅ 开箱即用
- ✅ 与应用打包在一起

**缺点：**
- ❌ 文件名必须小写+下划线
- ❌ 更新视频需要重新编译
- ❌ APK 文件会变大
- ❌ 视频会上传到 Git（但已加入 .gitignore）

### 外部存储方式（之前尝试）

**优点：**
- ✅ 支持中文文件名
- ✅ 更新视频不需重新编译
- ✅ APK 文件小

**缺点：**
- ❌ 需要存储权限
- ❌ Android 11+ 访问限制
- ❌ 需要手动复制文件到平板
- ❌ 实现复杂

---

## 🔍 故障排查

### 问题 1：视频文件未找到

**错误提示：**
```
视频文件未找到：video_fire_skills.mp4
请确保视频文件已放入 app/src/main/res/raw/ 文件夹
```

**解决方法：**
1. 检查 `app/src/main/res/raw/` 文件夹中是否有对应的视频文件
2. 检查文件名是否完全一致（包括大小写）
3. 执行 Clean Project 后重新编译

### 问题 2：资源命名无效

**错误提示：**
```
Error: 'C' is not a valid file-based resource name character
```

**原因：** 文件名中有大写字母或特殊字符

**解决方法：**
- 将所有大写字母改为小写
- 移除特殊字符
- 例如：`Video_Fire.mp4` → `video_fire.mp4`

### 问题 3：source error

**错误提示：**
```
播放出错：source error
```

**可能原因：**
1. 视频文件不存在
2. 视频格式不支持
3. 视频文件损坏

**解决方法：**
1. 确保视频格式为 MP4 (H.264 + AAC)
2. 使用视频转换工具重新编码
3. 测试视频文件能否在电脑上播放

### 问题 4：编译失败

**错误提示：**
```
Error: Invalid resource directory name
```

**解决方法：**
- 确保视频文件在 `raw` 文件夹中
- 不要创建子文件夹
- 检查文件名是否符合规则

---

## 📊 视频文件建议

### 推荐规格

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 格式 | MP4 | H.264 视频 + AAC 音频 |
| 分辨率 | 1280x720 | 720p，平板观看最佳 |
| 比特率 | 2-4 Mbps | 平衡质量和文件大小 |
| 帧率 | 24-30 fps | 流畅播放 |
| 音频 | AAC 128kbps | 清晰音质 |

### 文件大小参考

| 时长 | 分辨率 | 预估大小 |
|------|--------|----------|
| 1 分钟 | 720p | 15-20 MB |
| 3 分钟 | 720p | 45-60 MB |
| 5 分钟 | 720p | 75-100 MB |

---

## 🎓 如何添加新视频

### 步骤详解

#### 1. 准备视频文件
```
例如：新增"炒菜技巧"视频
```

#### 2. 重命名文件
```
原文件：炒菜技巧.mp4
新文件：video_cooking_tips.mp4
```

#### 3. 复制到 raw 文件夹
```
复制到：app/src/main/res/raw/video_cooking_tips.mp4
```

#### 4. 修改 VideoConfig.kt
```kotlin
fun getVideoList(): List<Video> {
    return listOf(
        // ... 现有视频 ...
        
        // 新增视频
        ,Video(
            id = 4,
            title = "炒菜技巧",
            description = "学习如何正确炒菜",
            duration = "3:00",
            resourceName = "video_cooking_tips",  // 不含 .mp4
            category = "烹饪技能",
            order = 4
        )
    )
}
```

#### 5. Rebuild 和 Run
```
Build → Rebuild Project
Run ▶️
```

---

## ✅ 完成检查清单

准备视频文件：
- [ ] 视频格式为 MP4
- [ ] 文件名使用小写字母、数字、下划线
- [ ] 文件名与 VideoConfig.kt 配置一致

添加到项目：
- [ ] 视频文件已复制到 `app/src/main/res/raw/`
- [ ] 执行了 Clean Project
- [ ] 执行了 Rebuild Project

测试播放：
- [ ] 应用成功编译
- [ ] 应用成功运行
- [ ] 视频列表显示正确
- [ ] 视频能正常播放
- [ ] 视频控制按钮正常
- [ ] 全屏功能正常

---

**修复日期：** 2026-01-01  
**当前状态：** ✅ 代码已修复，等待添加视频文件  
**测试状态：** ⏳ 添加视频文件后测试

添加视频文件后即可正常播放！🎬

