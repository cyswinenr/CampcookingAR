# 教师端服务器 - 打包成 EXE 文件说明

## 📦 打包步骤

### 1. 准备工作

确保已安装：
- Python 3.7 或更高版本
- 所有依赖包（运行 `pip install -r requirements.txt`）

### 2. 执行打包

**Windows 系统：**
```bash
# 双击运行或在命令行执行
build_exe.bat
```

**手动打包（如果批处理文件有问题）：**
```bash
# 1. 安装 PyInstaller
pip install pyinstaller

# 2. 执行打包
pyinstaller build_exe.spec
```

### 3. 打包结果

打包完成后，会在 `dist` 目录下生成：
- `教师端服务器.exe` - 可执行文件
- `templates/` - HTML 模板文件夹（与 exe 同目录）

## 📋 部署到其他电脑

### 方法 1：直接复制（推荐）

1. **复制文件**
   - 将 `dist/教师端服务器.exe` 复制到目标电脑
   - 将 `dist/templates/` 文件夹复制到 exe 同目录

2. **首次运行**
   - 双击运行 `教师端服务器.exe`
   - 程序会自动创建 `data/` 目录和数据库文件
   - 控制台会显示服务器地址和端口

3. **访问管理界面**
   - 打开浏览器访问：`http://本机IP:5000`
   - 例如：`http://192.168.1.100:5000`

### 方法 2：打包成安装包

可以使用 Inno Setup 或 NSIS 等工具将 exe 和 templates 文件夹打包成安装程序。

## ⚙️ 配置说明

### 数据存储位置

程序运行后，会在 exe 文件同目录下创建：
```
教师端服务器.exe
templates/
  └── index.html
data/
  ├── campcooking.db          # SQLite 数据库
  ├── students/                # 学生数据目录
  ├── media/                   # 媒体文件目录
  ├── evaluations/             # 评价数据目录
  └── exports/                 # 导出文件目录
```

### 端口配置

默认端口：**5000**

如需修改端口，可以：
1. 修改 `config.py` 中的 `PORT` 值后重新打包
2. 或直接修改源代码中的端口配置

### 防火墙设置

首次运行时，Windows 防火墙可能会提示：
- 选择"允许访问"或"允许应用通过防火墙"
- 确保端口 5000 未被其他程序占用

## 🔧 常见问题

### 1. 打包失败

**问题：** `ModuleNotFoundError: No module named 'xxx'`

**解决：**
```bash
# 确保所有依赖都已安装
pip install -r requirements.txt
pip install pyinstaller
```

### 2. 运行后找不到模板文件

**问题：** 程序运行但网页显示异常

**解决：**
- 确保 `templates/` 文件夹与 exe 文件在同一目录
- 检查 `templates/index.html` 文件是否存在

### 3. 数据库初始化失败

**问题：** 首次运行提示数据库错误

**解决：**
- 确保 exe 文件所在目录有写入权限
- 检查是否有杀毒软件阻止文件创建
- 尝试以管理员身份运行

### 4. 端口被占用

**问题：** 提示端口 5000 已被占用

**解决：**
- 关闭占用端口的其他程序
- 或修改 `config.py` 中的端口号后重新打包

### 5. 无法访问管理界面

**问题：** 浏览器无法打开管理界面

**解决：**
- 检查防火墙设置
- 确认服务器已启动（查看控制台输出）
- 使用 `http://127.0.0.1:5000` 测试本地访问
- 使用 `http://本机IP:5000` 测试局域网访问

## 📝 注意事项

1. **数据备份**
   - 定期备份 `data/` 目录
   - 特别是 `campcooking.db` 数据库文件

2. **版本更新**
   - 更新程序时，保留 `data/` 目录
   - 只替换 exe 文件和 templates 文件夹

3. **多实例运行**
   - 不要同时运行多个服务器实例
   - 每个实例会使用相同的数据库，可能导致数据冲突

4. **性能建议**
   - 建议在性能较好的电脑上运行
   - 如果学生端较多（20+），考虑使用生产级服务器（Waitress/Gunicorn）

## 🚀 生产环境部署

如果需要在生产环境部署，建议：

1. **使用生产级 WSGI 服务器**
   - 不要直接运行 exe（使用开发服务器）
   - 使用 Waitress 或 Gunicorn（需要修改代码）

2. **数据库备份**
   - 定期自动备份数据库
   - 设置备份计划任务

3. **日志管理**
   - 配置日志文件输出
   - 定期清理旧日志

## 📞 技术支持

如遇到问题，请检查：
1. 控制台输出的错误信息
2. `data/` 目录的权限设置
3. 防火墙和网络配置

