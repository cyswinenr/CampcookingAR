@echo off
chcp 65001 >nul
title 野炊教学数据管理系统 - 教师端服务器

REM ============================================================
REM 自动切换到脚本所在目录
REM ============================================================
cd /d "%~dp0"

REM ============================================================
REM 显示欢迎信息
REM ============================================================
echo.
echo ============================================================
echo   🏕️  野炊教学数据管理系统 - 教师端服务器
echo ============================================================
echo.
echo 正在检查环境...
echo.

REM ============================================================
REM 检查Python是否安装
REM ============================================================
python --version >nul 2>&1
if errorlevel 1 (
    echo [❌ 错误] 未检测到Python！
    echo.
    echo 请先安装Python 3.7或更高版本：
    echo 1. 访问 https://www.python.org/downloads/
    echo 2. 下载并安装Python
    echo 3. 安装时务必勾选 "Add Python to PATH"
    echo.
    pause
    exit /b 1
)

REM 显示Python版本
for /f "tokens=2" %%i in ('python --version 2^>^&1') do set PYTHON_VERSION=%%i
echo [✅] Python已安装 (版本: %PYTHON_VERSION%)
echo.

REM ============================================================
REM 检查依赖是否安装
REM ============================================================
echo 检查依赖包...
python -c "import flask" >nul 2>&1
if errorlevel 1 (
    echo [⚠️] Flask未安装，正在自动安装依赖包...
    echo.
    pip install -r requirements.txt
    if errorlevel 1 (
        echo.
        echo [❌ 错误] 依赖安装失败！
        echo 请检查网络连接，或手动运行: pip install -r requirements.txt
        echo.
        pause
        exit /b 1
    )
    echo.
    echo [✅] 依赖包安装完成
    echo.
) else (
    echo [✅] 依赖包已安装
    echo.
)

REM ============================================================
REM 启动服务器
REM ============================================================
echo ============================================================
echo   🚀 正在启动服务器...
echo ============================================================
echo.
echo 提示：
echo   - 服务器启动后，请记住显示的IP地址
echo   - 学生端和教师端APP需要使用这个IP地址
echo   - 按 Ctrl+C 可以停止服务器
echo.
echo ============================================================
echo.

python app.py

REM ============================================================
REM 服务器停止后的处理
REM ============================================================
echo.
echo ============================================================
echo   服务器已停止
echo ============================================================
echo.
pause

