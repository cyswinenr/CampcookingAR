@echo off
chcp 65001 >nul
title 野炊教学数据管理系统 - 数据库初始化

REM ============================================================
REM 自动切换到脚本所在目录
REM ============================================================
cd /d "%~dp0"

REM ============================================================
REM 显示欢迎信息
REM ============================================================
echo.
echo ============================================================
echo   野炊教学数据管理系统 - 数据库初始化
echo ============================================================
echo.

REM ============================================================
REM 检查Python是否安装
REM ============================================================
echo 正在检查Python环境...
python --version >nul 2>&1
if errorlevel 1 (
    echo [错误] 未检测到Python!
    echo.
    echo 请先安装Python 3.7或更高版本:
    echo 1. 访问 https://www.python.org/downloads/
    echo 2. 下载并安装Python
    echo 3. 安装时务必勾选 "Add Python to PATH"
    echo.
    pause
    exit /b 1
)

REM 显示Python版本
for /f "tokens=2" %%i in ('python --version 2^>^&1') do set PYTHON_VERSION=%%i
echo [成功] Python已安装 (版本: %PYTHON_VERSION%)
echo.

REM ============================================================
REM 初始化数据库
REM ============================================================
echo ============================================================
echo   正在初始化数据库...
echo ============================================================
echo.
echo 提示:
echo   - 将创建SQLite数据库文件
echo   - 将创建所有数据表和索引
echo   - 如果数据库已存在,将跳过已创建的表
echo.
echo ============================================================
echo.

python db_init.py

if errorlevel 1 (
    echo.
    echo ============================================================
    echo   数据库初始化失败!
    echo ============================================================
    echo.
    echo 请检查错误信息,或联系技术支持
    echo.
    pause
    exit /b 1
)

echo.
echo ============================================================
echo   数据库初始化完成!
echo ============================================================
echo.
echo 数据库文件位置: data\campcooking.db
echo.
echo 提示:
echo   - 数据库已准备就绪,可以启动服务器
echo   - 运行"启动服务器.bat"来启动服务器
echo.
pause

