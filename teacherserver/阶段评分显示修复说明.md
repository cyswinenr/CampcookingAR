# é˜¶æ®µè¯„åˆ†æ˜¾ç¤ºä¿®å¤è¯´æ˜

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®å¤æ•°æ®è¯»å–é€»è¾‘

**æ–‡ä»¶ï¼š** `teacherserver/storage.py`

**é—®é¢˜ï¼š**
- ä½¿ç”¨ `stage.self_rating or 0` å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
- æ²¡æœ‰æ­£ç¡®å¤„ç† None å€¼

**ä¿®å¤ï¼š**
```python
# ç¡®ä¿æ­£ç¡®è¯»å–è¯„åˆ†å€¼ï¼ˆå¤„ç† Noneã€0 ç­‰æƒ…å†µï¼‰
self_rating = stage.self_rating
if self_rating is None:
    self_rating = 0
else:
    # ç¡®ä¿æ˜¯æ•´æ•°ç±»å‹
    try:
        self_rating = int(self_rating)
    except (ValueError, TypeError):
        self_rating = 0
```

### 2. å¢å¼ºå‰ç«¯æ•°æ®è§£æ

**æ–‡ä»¶ï¼š** `teacherserver/templates/index.html`

**æ”¹è¿›ï¼š**
- æ·»åŠ äº†æ›´ä¸¥æ ¼çš„æ•°æ®ç±»å‹æ£€æŸ¥
- æ·»åŠ äº†è¯„åˆ†èŒƒå›´éªŒè¯ï¼ˆ1-5ï¼‰
- æ·»åŠ äº†è°ƒè¯•æ—¥å¿—è¾“å‡º
- å¤„ç†å„ç§å¯èƒ½çš„æ•°æ®æ ¼å¼

**å…³é”®ä»£ç ï¼š**
```javascript
// å¤„ç†å„ç§å¯èƒ½çš„æ•°æ®æ ¼å¼
if (typeof stageRating === 'object' && 'selfRating' in stageRating) {
    rating = parseInt(stageRating.selfRating) || 0;
} else if (typeof stageRating === 'number') {
    rating = stageRating;
} else {
    rating = parseInt(stageRating) || 0;
}

// ç¡®ä¿è¯„åˆ†åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆ1-5ï¼‰
if (rating < 0) rating = 0;
if (rating > 5) rating = 5;
```

### 3. æ·»åŠ è°ƒè¯•æ—¥å¿—

**æ–‡ä»¶ï¼š**
- `teacherserver/storage.py` - è®°å½•æ¯ä¸ªé˜¶æ®µçš„è¯„åˆ†
- `teacherserver/app.py` - è®°å½•APIè¿”å›çš„è¯„åˆ†æ•°æ®
- `teacherserver/db_manager.py` - è®°å½•ä»æ•°æ®åº“è¯»å–çš„åŸå§‹æ•°æ®
- `teacherserver/templates/index.html` - æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º

## ğŸ” æ•°æ®æµç¨‹éªŒè¯

### 1. æ•°æ®åº“ â†’ Python å¯¹è±¡

**ä½ç½®ï¼š** `db_manager.py` â†’ `get_process_record()`

```python
# ä»æ•°æ®åº“è¯»å–é˜¶æ®µè®°å½•
stage_rows = self._fetch_all("SELECT * FROM stage_records WHERE ...")
# åˆ›å»º StageRecord å¯¹è±¡
stage = StageRecord(row)
# è®°å½•è°ƒè¯•ä¿¡æ¯
logger.debug(f"ä»æ•°æ®åº“è¯»å–é˜¶æ®µ {stage.stage_name}: self_rating={row.get('self_rating')}")
```

### 2. Python å¯¹è±¡ â†’ API å“åº”

**ä½ç½®ï¼š** `storage.py` â†’ `get_all_students()`

```python
# æå–æ¯ä¸ªé˜¶æ®µçš„è¯„åˆ†
for stage in stages:
    self_rating = stage.self_rating
    if self_rating is None:
        self_rating = 0
    else:
        self_rating = int(self_rating)
    
    stage_ratings[stage.stage_name] = {
        'selfRating': self_rating,
        'isCompleted': stage.is_completed
    }
```

### 3. API å“åº” â†’ å‰ç«¯æ˜¾ç¤º

**ä½ç½®ï¼š** `templates/index.html` â†’ `renderStudentsList()`

```javascript
// è§£æè¯„åˆ†æ•°æ®
const stageRating = stageRatings[stageKey];
let rating = 0;
if (stageRating) {
    if (typeof stageRating === 'object' && 'selfRating' in stageRating) {
        rating = parseInt(stageRating.selfRating) || 0;
    }
}

// æ˜¾ç¤ºæ˜Ÿæ˜Ÿ
const stars = hasRating 
    ? 'â˜…'.repeat(rating) + 'â˜†'.repeat(5 - rating)
    : 'â˜†â˜†â˜†â˜†â˜†';
```

## ğŸ“Š æ˜¾ç¤ºè§„åˆ™

### æœ‰è¯„åˆ†çš„é˜¶æ®µ
- **1æ˜Ÿï¼š** â˜…â˜†â˜†â˜†â˜†
- **2æ˜Ÿï¼š** â˜…â˜…â˜†â˜†â˜†
- **3æ˜Ÿï¼š** â˜…â˜…â˜…â˜†â˜†
- **4æ˜Ÿï¼š** â˜…â˜…â˜…â˜…â˜†
- **5æ˜Ÿï¼š** â˜…â˜…â˜…â˜…â˜…
- **æ ·å¼ï¼š** æ©™è‰²èƒŒæ™¯é«˜äº®

### æ²¡æœ‰è¯„åˆ†çš„é˜¶æ®µ
- **æ˜¾ç¤ºï¼š** â˜†â˜†â˜†â˜†â˜†
- **æ ·å¼ï¼š** ç°è‰²èƒŒæ™¯

## ğŸ› è°ƒè¯•æ–¹æ³•

### 1. æ£€æŸ¥æ•°æ®åº“æ•°æ®

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼ˆè§ `æµ‹è¯•é˜¶æ®µè¯„åˆ†æ˜¾ç¤º.md`ï¼‰ï¼š
```python
# æŸ¥è¯¢æ•°æ®åº“ä¸­çš„è¯„åˆ†
SELECT stage_name, self_rating FROM stage_records;
```

### 2. æ£€æŸ¥ API å“åº”

è®¿é—® `http://localhost:5000/api/students`ï¼ŒæŸ¥çœ‹ JSON å“åº”ä¸­çš„ `stageRatings` å­—æ®µã€‚

### 3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ï¼š
- `å­¦ç”Ÿ xxx çš„è¯„åˆ†æ•°æ®: {...}`
- `é˜¶æ®µ xxx: X æ˜Ÿ`

### 4. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è¾“å‡ºï¼š
- `é˜¶æ®µ xxx è¯„åˆ†: X`
- `ä»æ•°æ®åº“è¯»å–é˜¶æ®µ xxx: self_rating=X`

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¯„åˆ†å€¼èŒƒå›´**
   - æœ‰æ•ˆèŒƒå›´ï¼š0-5
   - 0 è¡¨ç¤ºæ²¡æœ‰è¯„åˆ†ï¼ˆæ˜¾ç¤ºç©ºæ˜Ÿï¼‰
   - 1-5 è¡¨ç¤ºæœ‰è¯„åˆ†ï¼ˆæ˜¾ç¤ºæ˜Ÿæ˜Ÿï¼‰

2. **é˜¶æ®µåç§°**
   - å¿…é¡»ä¸ `STAGE_ORDER` ä¸­çš„é”®å®Œå…¨åŒ¹é…
   - å¤§å°å†™æ•æ„Ÿï¼š`PREPARATION` ä¸æ˜¯ `preparation`

3. **æ•°æ®æ›´æ–°**
   - ä¿®æ”¹æ•°æ®åº“åéœ€è¦åˆ·æ–°é¡µé¢
   - å»ºè®®ä½¿ç”¨å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5ï¼‰æ¸…é™¤ç¼“å­˜

## âœ… éªŒè¯æ¸…å•

- [ ] æ•°æ®åº“ä¸­æœ‰è¯„åˆ†æ•°æ®æ—¶ï¼Œæ­£ç¡®æ˜¾ç¤ºæ˜Ÿæ˜Ÿ
- [ ] æ•°æ®åº“ä¸­æ²¡æœ‰è¯„åˆ†æ•°æ®æ—¶ï¼Œæ˜¾ç¤ºç©ºæ˜Ÿ
- [ ] éƒ¨åˆ†é˜¶æ®µæœ‰è¯„åˆ†æ—¶ï¼Œæ­£ç¡®æ˜¾ç¤ºæ··åˆçŠ¶æ€
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰é”™è¯¯
- [ ] æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤ºæ­£ç¡®çš„è¯„åˆ†å€¼
- [ ] API å“åº”åŒ…å« `stageRatings` å­—æ®µ

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-01-03
**ä¿®å¤ç‰ˆæœ¬ï¼š** v1.1

