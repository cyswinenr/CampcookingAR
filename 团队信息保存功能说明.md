# 📝 团队信息保存功能说明

## ✅ 已完成持久化保存功能

团队信息登记页面现在支持数据持久化保存，即使退出应用，数据也会保留！

---

## 🎯 功能特点

### ✅ 自动保存
- 点击"保存"按钮手动保存
- 点击"开始野炊"按钮自动保存
- 数据保存在应用本地存储

### ✅ 自动加载
- 重新打开应用时自动恢复
- 无需手动输入
- 提示"已恢复上次保存的信息"

### ✅ 数据保留
- 应用关闭后数据不丢失
- 重启应用数据依然存在
- 只有点击"重置"才会清除

---

## 🎮 使用方法

### 1️⃣ 保存信息

#### 方法一：点击"保存"按钮
```
填写信息 → 点击"保存" → 显示"信息已保存"
```

#### 方法二：点击"开始野炊"按钮
```
填写信息 → 点击"开始野炊" → 自动保存 → 进入野炊
```

### 2️⃣ 重新打开应用

```
关闭应用 → 重新打开 → 自动加载上次的数据 → 显示"已恢复上次保存的信息"
```

### 3️⃣ 清除保存的数据

```
点击"重置" → 确认 → 清空表单 → 清除保存的数据
```

---

## 📋 保存的数据项

会保存以下所有信息：

| 数据项 | 说明 | 示例 |
|--------|------|------|
| 学校 | 学校名称 | "某某中学" |
| 年级 | 高一/高二 | "高一" |
| 班级 | 1-25班 | "3班" |
| 炉号 | 1-20号炉 | "5号炉" |
| 小组人数 | 1-15人 | 5 |
| 成员姓名 | 所有成员姓名 | "张三、李四、王五、..." |

---

## 🎬 使用场景

### 场景 1：中途退出应用
```
1. 老师：填写团队信息到一半
2. 临时有事，关闭应用
3. 稍后重新打开应用
4. ✅ 之前填写的信息都还在！
```

### 场景 2：保存常用信息
```
1. 学生：每次野炊都是同一个小组
2. 第一次填写完整信息
3. 点击"保存"
4. 以后每次打开应用
5. ✅ 信息自动填充，只需修改日期相关的内容
```

### 场景 3：多次使用
```
1. 班级：每周都有野炊课
2. 小组信息基本不变
3. 只需更改炉号等个别信息
4. ✅ 大大节省时间！
```

---

## 🔧 技术实现

### 使用 SharedPreferences
- Android 标准的轻量级存储方案
- 数据以键值对形式保存
- 应用私有，安全可靠

### 数据管理类
创建了 `TeamInfoManager.kt`：

```kotlin
// 保存数据
teamInfoManager.saveTeamInfo(teamInfo)

// 加载数据
val savedInfo = teamInfoManager.loadTeamInfo()

// 清除数据
teamInfoManager.clearTeamInfo()

// 检查是否有数据
val hasData = teamInfoManager.hasData()
```

### 存储位置
```
/data/data/com.campcooking.ar/shared_prefs/team_info_prefs.xml
```

---

## 🎨 界面变化

### 按钮布局（横屏）

```
┌──────────────────────────────────────┐
│                                      │
│  [表单内容...]                       │
│                                      │
│  ┌─────┐  ┌─────┐  ┌──────────┐    │
│  │重置 │  │保存 │  │开始野炊  │    │
│  └─────┘  └─────┘  └──────────┘    │
│    ⬜       🟢        🟠             │
└──────────────────────────────────────┘
```

### 按钮说明

| 按钮 | 颜色 | 功能 |
|------|------|------|
| 重置 | ⬜ 透明（橙色边框） | 清空表单 + 清除保存的数据 |
| 保存 | 🟢 绿色 | 保存当前信息 |
| 开始野炊 | 🟠 橙色 | 自动保存 + 进入野炊 |

---

## 💡 使用提示

### ✅ 好习惯
1. **填完信息后立即保存**
   - 防止意外退出导致数据丢失
   
2. **信息变更后记得保存**
   - 修改了成员信息
   - 记得点击"保存"

3. **新学期开始时重置**
   - 新学期班级可能调整
   - 点击"重置"清除旧数据

### ⚠️ 注意事项
1. **重置会清除保存的数据**
   - 点击"重置"前会有确认对话框
   - 确认后无法撤销

2. **卸载应用会丢失数据**
   - 应用被卸载，数据会清空
   - 建议不要频繁卸载

3. **清除应用数据会丢失**
   - 在系统设置中清除数据
   - 保存的信息会被删除

---

## 🎯 功能测试

### 测试步骤

#### 1. 测试保存功能
```
1. 打开应用
2. 填写完整的团队信息
3. 点击"保存"按钮
4. ✅ 看到提示"信息已保存"
```

#### 2. 测试加载功能
```
1. 完成上述保存操作
2. 按返回键退出应用
3. 重新打开应用
4. ✅ 看到提示"已恢复上次保存的信息"
5. ✅ 所有输入框都有数据
```

#### 3. 测试重置功能
```
1. 已有保存的数据
2. 点击"重置"按钮
3. 点击"确定"
4. ✅ 表单清空
5. 退出应用再打开
6. ✅ 不再有保存的数据
```

#### 4. 测试开始野炊自动保存
```
1. 填写团队信息
2. 点击"开始野炊"
3. 进入野炊页面后返回
4. 退出应用再打开
5. ✅ 信息依然保存
```

---

## 📊 数据流程图

```
┌─────────────┐
│  填写信息   │
└──────┬──────┘
       │
       ├─────► 点击"保存" ──────► 保存到本地
       │                          └─► SharedPreferences
       │
       └─────► 点击"开始野炊" ───► 保存到本地 + 跳转页面
                                   └─► SharedPreferences

┌─────────────┐
│  打开应用   │
└──────┬──────┘
       │
       └─────► 检查是否有保存数据
               │
               ├─ 有 ──► 自动加载 ──► 填充表单
               │
               └─ 无 ──► 空白表单

┌─────────────┐
│  点击重置   │
└──────┬──────┘
       │
       └─────► 确认对话框
               │
               └─ 确定 ──► 清空表单 + 清除保存数据
```

---

## 🔍 常见问题

### Q1：点击保存后没有提示？

**原因：** 可能验证失败

**解决方法：**
1. 确保所有必填项都已填写
2. 年级、班级、炉号都已选择
3. 小组人数在 1-15 之间
4. 所有成员姓名都已填写

### Q2：重新打开应用数据没有恢复？

**可能原因：**

**原因 1：没有保存**
- 解决：记得点击"保存"或"开始野炊"

**原因 2：点击了重置**
- 解决：重置会清除保存的数据

**原因 3：清除了应用数据**
- 解决：避免在系统设置中清除数据

### Q3：想修改部分信息怎么办？

**步骤：**
1. 应用会自动加载之前的数据
2. 直接修改需要更改的字段
3. 点击"保存"更新数据

### Q4：多个班级使用同一台平板？

**建议方案：**

**方案 1：每个班级用完重置**
```
班级 A 使用 → 保存 → 野炊完成 → 重置
班级 B 使用 → 填写新数据 → 保存
```

**方案 2：使用不同账户**
```
不同的 Android 用户账户
数据互不干扰
```

### Q5：如何备份数据？

**说明：**
- 当前版本不支持导出/导入
- 数据存储在应用内部
- 卸载应用会丢失数据

**未来功能：**
- 可以考虑添加导出为文件功能
- 可以考虑添加云端同步功能

---

## 🚀 开发细节

### 代码位置

#### 1. 数据管理类
```
app/src/main/java/com/campcooking/ar/utils/TeamInfoManager.kt
```

#### 2. MainActivity 修改
```
app/src/main/java/com/campcooking/ar/MainActivity.kt
```

#### 3. 布局文件修改
```
app/src/main/res/layout-land/activity_main.xml
app/src/main/res/layout/activity_main.xml
```

### 关键方法

```kotlin
// 保存数据
private fun saveTeamInfo() {
    teamInfoManager.saveTeamInfo(teamInfo)
    Toast.makeText(this, "信息已保存", Toast.LENGTH_SHORT).show()
}

// 加载数据
private fun loadSavedData() {
    val savedInfo = teamInfoManager.loadTeamInfo()
    if (savedInfo != null) {
        // 恢复各个字段...
    }
}

// 重置（包括清除持久化数据）
private fun resetForm() {
    // 清空表单...
    teamInfoManager.clearTeamInfo()
}
```

---

## 📱 用户体验提升

### 之前
```
每次打开应用 → 重新填写所有信息 → 费时费力 ❌
```

### 现在
```
第一次：填写信息 → 保存 ✅
以后：打开应用 → 信息自动填充 → 快速开始 ✅
```

### 节省时间
- **首次填写：** 约 2-3 分钟
- **后续使用：** 约 10 秒（确认信息）
- **节省时间：** 90%+ 🎉

---

## 🎓 教学建议

### 对老师
1. **第一次使用**
   - 指导学生完整填写信息
   - 强调点击"保存"的重要性

2. **后续课程**
   - 提醒学生检查信息是否正确
   - 如有变更及时更新并保存

3. **学期末/换组**
   - 提醒学生点击"重置"
   - 清除旧数据，避免混淆

### 对学生
1. **养成保存习惯**
   - 填完信息立即保存
   
2. **定期检查**
   - 打开应用时检查信息是否正确
   
3. **信息变更记得更新**
   - 成员调整、炉号更换等

---

**实现日期：** 2026-01-01  
**功能状态：** ✅ 已完成  
**测试状态：** 请在实际设备上测试

享受便捷的数据保存体验！📝💾

